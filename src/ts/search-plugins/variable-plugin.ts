import { SearchResultItem } from "../search-result-item";
import { SearchPlugin } from "./search-plugin";
import { FilePathInputValidator } from "../input-validators/file-path-input-validator";

export class VariableSearchPlugin implements SearchPlugin {
    private items: SearchResultItem[];
    private icon = `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1">
                        <g id="surface1">
                            <path d=" M 17.856 20.106 L 17.856 20.106 L 17.856 20.106 Q 17.866 19.218 17.207 18.583 L 17.207 18.583 L 17.207 18.583 Q 16.548 17.948 15.112 17.479 L 15.112 17.479 L 15.112 17.479 Q 14.204 17.196 13.472 16.825 L 13.472 16.825 L 13.472 16.825 Q 12.739 16.454 12.217 15.941 L 12.217 15.941 L 12.217 15.941 Q 11.694 15.429 11.411 14.765 L 11.411 14.765 L 11.411 14.765 Q 11.128 14.101 11.128 13.231 L 11.128 13.231 L 11.128 13.231 Q 11.128 12.411 11.377 11.747 L 11.377 11.747 L 11.377 11.747 Q 11.626 11.083 12.08 10.59 L 12.08 10.59 L 12.08 10.59 Q 12.534 10.097 13.184 9.794 L 13.184 9.794 L 13.184 9.794 Q 13.833 9.491 14.624 9.394 L 14.624 9.394 L 14.624 7.245 L 16.079 7.245 L 16.079 9.394 L 16.079 9.394 Q 17.72 9.618 18.628 10.775 L 18.628 10.775 L 18.628 10.775 Q 19.536 11.933 19.546 13.925 L 19.546 13.925 L 17.749 13.925 L 17.749 13.925 Q 17.749 13.271 17.588 12.719 L 17.588 12.719 L 17.588 12.719 Q 17.427 12.167 17.119 11.771 L 17.119 11.771 L 17.119 11.771 Q 16.812 11.376 16.362 11.151 L 16.362 11.151 L 16.362 11.151 Q 15.913 10.927 15.337 10.927 L 15.337 10.927 L 15.337 10.927 Q 14.155 10.927 13.55 11.542 L 13.55 11.542 L 13.55 11.542 Q 12.944 12.157 12.935 13.202 L 12.935 13.202 L 12.935 13.202 Q 12.935 13.69 13.091 14.071 L 13.091 14.071 L 13.091 14.071 Q 13.247 14.452 13.584 14.765 L 13.584 14.765 L 13.584 14.765 Q 13.921 15.077 14.453 15.346 L 14.453 15.346 L 14.453 15.346 Q 14.985 15.614 15.737 15.868 L 15.737 15.868 L 15.737 15.868 Q 16.655 16.171 17.388 16.542 L 17.388 16.542 L 17.388 16.542 Q 18.12 16.913 18.628 17.411 L 18.628 17.411 L 18.628 17.411 Q 19.136 17.909 19.404 18.563 L 19.404 18.563 L 19.404 18.563 Q 19.673 19.218 19.673 20.087 L 19.673 20.087 L 19.673 20.087 Q 19.673 20.937 19.404 21.61 L 19.404 21.61 L 19.404 21.61 Q 19.136 22.284 18.647 22.768 L 18.647 22.768 L 18.647 22.768 Q 18.159 23.251 17.461 23.544 L 17.461 23.544 L 17.461 23.544 Q 16.763 23.837 15.913 23.925 L 15.913 23.925 L 15.913 25.8 L 14.458 25.8 L 14.458 23.935 L 14.458 23.935 Q 13.696 23.856 12.998 23.583 L 12.998 23.583 L 12.998 23.583 Q 12.3 23.31 11.763 22.787 L 11.763 22.787 L 11.763 22.787 Q 11.226 22.265 10.903 21.474 L 10.903 21.474 L 10.903 21.474 Q 10.581 20.683 10.581 19.579 L 10.581 19.579 L 12.388 19.579 L 12.388 19.579 Q 12.388 20.399 12.632 20.941 L 12.632 20.941 L 12.632 20.941 Q 12.876 21.483 13.262 21.806 L 13.262 21.806 L 13.262 21.806 Q 13.647 22.128 14.136 22.265 L 14.136 22.265 L 14.136 22.265 Q 14.624 22.401 15.122 22.401 L 15.122 22.401 L 15.122 22.401 Q 15.757 22.401 16.265 22.245 L 16.265 22.245 L 16.265 22.245 Q 16.772 22.089 17.124 21.791 L 17.124 21.791 L 17.124 21.791 Q 17.476 21.493 17.666 21.068 L 17.666 21.068 L 17.666 21.068 Q 17.856 20.644 17.856 20.106 Z "></path>
                        </g>
                    </svg>`;

    public constructor(validator: FilePathInputValidator, environmentVariables: { [key: string]: string }) {
        this.items = [];
        for (const variableName of Object.keys(environmentVariables)) {
            const value = environmentVariables[variableName];
            if (validator.isValidForSearchResults(value)) {
                this.items.push({
                    executionArgument: value,
                    icon: this.icon,
                    name: variableName,
                    tags: [],
                });
            }
        }
    }

    public getAllItems(): SearchResultItem[] {
        return this.items;
    }
}
